$(document).ready(function(){var t=[];$("select:not(.ignore)").niceSelect(),$(".accordion").accordion({firstChildExpand:!0,multiExpand:!1,slideSpeed:500,dropDownIcon:'<img src="images/apc/down-chevron.png" width="24"/>'});var e=window.innerWidth>=1600?1:window.innerWidth/1600;$("body").css({zoom:e}),$(window).on("resize",function(){$("body").css({zoom:e})});var a={searching:!1,paging:!1,ordering:!1,info:!1,columns:[{title:"Mã hóa đơn"},{title:"Serial"}]},n=$("#input_table");n.DataTable(a);var r=n.DataTable(),i=$.extend(!0,{},a);i.dom="Bfrtip";var o=$.extend(!0,{},i);o.buttons=[{extend:"excelHtml5",title:"DailyAirPay_4th_Prize"}],$("#output_table_4").DataTable(o);var l=$.extend(!0,{},i);l.buttons=[{extend:"excelHtml5",title:"DailyAirPay_3rd_Prize"}],$("#output_table_3").DataTable(l);var d=$.extend(!0,{},i);d.buttons=[{extend:"excelHtml5",title:"DailyAirPay_2nd_Prize"}],$("#output_table_2").DataTable(d);var c=$.extend(!0,{},i);c.buttons=[{extend:"excelHtml5",title:"DailyAirPay_1st_Prize"}],$("#output_table_1").DataTable(c),$(".btn_trigger").on("click",function(){!function(t){for(var e=t.length;e;e-=1){var a=Math.floor(Math.random()*e),n=t[e-1];t[e-1]=t[a],t[a]=n}}(t);var e=parseInt($(this).attr("data-id")),a=$("#quantity_"+e),n=parseInt(a.val())||0;if(n<=0)return alert("Vui lòng nhập số lượng quay thưởng hợp lệ !"),!1;if(n>t.length)return alert("Số lượng quay thưởng không được lớn hơn danh sách quay thưởng (Còn lại: "+t.length+" khách hàng) !"),!1;a.attr("readonly","");for(var r=[],i=[],o=0;o<n;o++){if(!(t.length>0)){alert("Giải đã được trao hết !");break}var l=t[0];r.push(l),i.push(l[1]);for(var d=0;d<t.length;)t[d][1]===r[o][1]?t.splice(d,1):d++}v(p),window.setTimeout(function(){var t=i.join(", ");$("#result_"+e).val(t);var a=$("#output_table_"+e),n=a.DataTable();$.each(r,function(t,e){for(t=0;t<e.length;t++)e[t]+='<hr class="hr-table">';n.row.add(e).draw(!1)}),a.show(),v(u)},3e3),$(this).css("-webkit-filter","grayscale(100%)"),$(this).prop("disabled",!0)}),$(".drawer").on("click",function(){var t=parseInt($(this).find(".btn_trigger").attr("data-id")),e="";switch(t){case 1:e="nhất";break;case 2:e="nhì";break;case 3:e="ba";break;case 4:e="khuyến khích"}$("#result_title").text(e),$(".output").hide(),$(".btn_export").attr("data-id",t);var a=$("#output_table_"+t);a.DataTable().page.info().recordsTotal&&a.show()}),$(".btn_export").on("click",function(){var t=parseInt($(this).attr("data-id"));$("#output_table_"+t+"_wrapper").find(".buttons-excel").click()});var s=$("#input_file");function h(e){var a=e.target.files[0],i=(a.name,new FileReader);i.onload=function(e){var a=e.target.result,i=XLS.CFB.read(a,{type:"binary"}),o=XLS.parse_xlscfb(i);o.SheetNames.forEach(function(e){XLS.utils.make_csv(o.Sheets[e]);var a=XLS.utils.sheet_to_row_object_array(o.Sheets[e]);$.each(a,function(e,a){var n=a.ma_hoa_don||"",i=a.serial||"";if(""!==n||""!==i){var o=[n,i];t.push(o),r.row.add(o).draw(!1)}}),n.show(),s.hide()})},i.readAsBinaryString(a)}$(function(){var e=document.getElementById("input_file");e.addEventListener&&(r.clear().draw(),t.length=0,e.addEventListener("change",h,!1))});var u=0,p=1;function v(t){if($("#overlay").length&&$("#overlay").remove(),t===p){var e=$('<div id="overlay"><div id="loader"><img id="loading" src="images/airpay_logo.png"></div></div>');e.show(),e.appendTo(document.body)}}});