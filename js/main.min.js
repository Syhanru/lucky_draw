function getRandomInteger(t,e){return t=Math.ceil(t),e=Math.floor(e),Math.floor(Math.random()*(e-t))+t}function shuffle(t){for(var e=t.length;e;e-=1){var a=Math.floor(Math.random()*e),n=t[e-1];t[e-1]=t[a],t[a]=n}}var LOADER_HIDE=0,LOADER_SHOW=1;function appendLoader(t){if($("#overlay").length&&$("#overlay").remove(),t===LOADER_SHOW){var e=$('<div id="overlay"><div id="loader"><img id="loading" src="images/airpay_logo.png"></div></div>');e.show(),e.appendTo(document.body)}}$(document).ready(function(){var t=[];$("select:not(.ignore)").niceSelect(),$(".accordion").accordion({firstChildExpand:!0,multiExpand:!1,slideSpeed:500,dropDownIcon:'<img src="images/apc/down-chevron.png" width="24"/>'});var e=window.innerWidth>=1600?1:window.innerWidth/1600;$("body").css({zoom:e}),$(window).on("resize",function(){$("body").css({zoom:e})});var a={searching:!1,paging:!1,ordering:!1,info:!1,columns:[{title:"Mã hóa đơn"},{title:"Serial"}]},n=$.extend(!0,{},a);n.dom="Bfrtip";var r=$.extend(!0,{},n);r.buttons=[{extend:"excelHtml5",title:"DailyAirPay_4th_Prize"}];var i=$.extend(!0,{},n);i.buttons=[{extend:"excelHtml5",title:"DailyAirPay_3rd_Prize"}];var o=$.extend(!0,{},n);o.buttons=[{extend:"excelHtml5",title:"DailyAirPay_2nd_Prize"}];var d=$.extend(!0,{},n);d.buttons=[{extend:"excelHtml5",title:"DailyAirPay_1st_Prize"}];var l={4:r,3:i,2:o,1:d};function c(e){var n=e.target.files[0],r=new FileReader;r.onload=function(e){var n=e.target.result,r=XLSX.read(n,{type:"binary"});r.SheetNames.forEach(function(e){var n=XLSX.utils.sheet_to_json(r.Sheets[e]);$.each(n,function(e,a){var n=a.ma_hoa_don||"",r=a.serial||"";if(""!==n||""!==r){var i=[n,r];t.push(i)}});var i=$.extend(!0,{},a);i.data=t.slice(0,1e3);var o=$("#input_table");o.DataTable(i),o.show(),$("#input_file").hide()})},r.readAsBinaryString(n)}$(".btn_trigger").on("click",function(){shuffle(t);var e=parseInt($(this).attr("data-id")),a=$("#quantity_"+e),n=parseInt(a.val())||0;if(n<=0)return alert("Vui lòng nhập số lượng quay thưởng hợp lệ !"),!1;if(n>t.length)return alert("Số lượng quay thưởng không được lớn hơn danh sách quay thưởng (Còn lại: "+t.length+" khách hàng) !"),!1;a.attr("readonly","");for(var r=[],i=[],o=0;o<n;o++){if(!(t.length>0)){alert("Giải đã được trao hết !");break}var d=getRandomInteger(0,t.length-1),c=t[d];r.push(c),i.push(c[1]),t.splice(d,1)}appendLoader(LOADER_SHOW),window.setTimeout(function(){var t=i.join(", ");$("#result_"+e).val(t);var a=$("#output_table_"+e);$.each(r,function(t,e){for(t=0;t<e.length;t++)e[t]+='<hr class="hr-table">'});var n=l[e];n.data=r,a.DataTable(n),a.show(),appendLoader(LOADER_HIDE)},getRandomInteger(3e3,6e3)),$(this).css("-webkit-filter","grayscale(100%)"),$(this).prop("disabled",!0)}),$(".drawer").on("click",function(){var t=parseInt($(this).find(".btn_trigger").attr("data-id")),e="";switch(t){case 1:e="nhất";break;case 2:e="nhì";break;case 3:e="ba";break;case 4:e="khuyến khích"}$("#result_title").text(e),$(".output").hide(),$(".btn_export").attr("data-id",t),$("#output_table_"+t).show()}),$(".btn_export").on("click",function(){var t=parseInt($(this).attr("data-id"));$("#output_table_"+t+"_wrapper").find(".buttons-excel").click()}),$(function(){var e=document.getElementById("input_file");e.addEventListener&&(t.length=0,e.addEventListener("change",c,!1))})});